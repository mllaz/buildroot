################################################################################
#
# wpeframework-netflix
#
################################################################################

WPEFRAMEWORK_NETFLIX_VERSION = a9a16ad4a64af7f41fe73558d29c5312703a85fc
ifeq ($(BR2_PACKAGE_NETFLIX5),y)
# Netflix 5 has a little different API, use "netflix5" branch for now.
WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DNETFLIX_VERSION_5=true
WPEFRAMEWORK_NETFLIX_DEPENDENCIES = wpeframework netflix5
ifeq ($(BR2_PACKAGE_NETFLIX5_1),y)
WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DNETFLIX_VERSION_5_1=true
endif
else
WPEFRAMEWORK_NETFLIX_DEPENDENCIES = wpeframework netflix
endif

WPEFRAMEWORK_NETFLIX_SITE_METHOD = git
WPEFRAMEWORK_NETFLIX_SITE = git@github.com:WebPlatformForEmbedded/WPEPluginNetflix.git
WPEFRAMEWORK_NETFLIX_INSTALL_STAGING = YES

# wpeframework-netflix binary package config
WPEFRAMEWORK_NETFLIX_OPKG_NAME = "wpeframework-netflix"
WPEFRAMEWORK_NETFLIX_OPKG_VERSION = "1.0.0"
WPEFRAMEWORK_NETFLIX_OPKG_ARCHITECTURE = "${BR2_ARCH}"
WPEFRAMEWORK_NETFLIX_OPKG_MAINTAINER = "Metrological"
WPEFRAMEWORK_NETFLIX_OPKG_DESCRIPTION = "WPEFramework Netflix plugin"

WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DBUILD_REFERENCE=${WPEFRAMEWORK_NETFLIX_VERSION}

# TODO: Do not have WPEFRAMEWORK versioning yet
# WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DPLUGIN_NETFLIX_VERSION="$(WEBBRIDGE_BUILD_VERSION)-dev"

ifeq ($(BR2_PACKAGE_PLUGIN_NETFLIX_NETFLIX_AUTOSTART),y)
WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DPLUGIN_NETFLIX_AUTOSTART=true
else
WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DPLUGIN_NETFLIX_AUTOSTART=false
endif

ifneq ($(BR2_PACKAGE_PLUGIN_NETFLIX_NETFLIX_MODEL),)
WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DPLUGIN_NETFLIX_MODEL="$(call qstrip,$(BR2_PACKAGE_PLUGIN_NETFLIX_NETFLIX_MODEL))"
endif

ifneq ($(BR2_PACKAGE_PLUGIN_NETFLIX_NETFLIX_SUSPEND_TIMEOUT),)
WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DPLUGIN_NETFLIX_SUSPENDTIMEOUT="$(call qstrip,$(BR2_PACKAGE_PLUGIN_NETFLIX_NETFLIX_SUSPEND_TIMEOUT))"
endif

ifneq ($(BR2_PACKAGE_PLUGIN_NETFLIX_NETFLIX_RESUME_TIMEOUT),)
WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DPLUGIN_NETFLIX_RESUMETIMEOUT="$(call qstrip,$(BR2_PACKAGE_PLUGIN_NETFLIX_NETFLIX_RESUME_TIMEOUT))"
endif

ifeq ($(BR2_PACKAGE_PLUGIN_NETFLIX_NETFLIX_FULLHD),y)
WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DPLUGIN_NETFLIX_FULLHD=true
else
WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DPLUGIN_NETFLIX_FULLHD=false
endif

ifeq ($(BR2_PACKAGE_NETFLIX5),y)
ifeq  ($(BR2_PACKAGE_RPI_FIRMWARE),y)
WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DPLUGIN_SPLASH_IMAGE_FORMAT=PNG
WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DPLUGIN_ENABLE_AUDIO_DOWNMIX=true
WPEFRAMEWORK_NETFLIX_DEPENDENCIES += gst1-libav
endif
endif

ifeq ($(BR2_PACKAGE_WPEFRAMEWORK_CREATE_IPKG_TARGETS),y)

WPEFRAMEWORK_NETFLIX_CONF_OPTS += -DWPEFRAMEWORK_CREATE_IPKG_TARGETS=ON

$(call SIMPLE_OPKG_TOOLS_CREATE_CPACK_METADATA,WPEFRAMEWORK_NETFLIX)
WPEFRAMEWORK_NETFLIX_CONF_OPTS += ${WPEFRAMEWORK_NETFLIX_OPKG_CPACK_METADATA}

WPEFRAMEWORK_NETFLIX_POST_BUILD_HOOKS += SIMPLE_OPKG_TOOLS_MAKE_PACKAGE

define WPEFRAMEWORK_NETFLIX_INSTALL_TARGET_CMDS
	@# install package
	$(call SIMPLE_OPKG_TOOLS_INSTALL_PACKAGE,\
	${@D}/${WPEFRAMEWORK_NETFLIX_OPKG_NAME}_${WPEFRAMEWORK_NETFLIX_OPKG_VERSION}_${WPEFRAMEWORK_NETFLIX_OPKG_ARCHITECTURE}.deb)
endef # WPEFRAMEWORK_NETFLIX_INSTALL_TARGET_CMDS

endif # ($(BR2_PACKAGE_WPEFRAMEWORK_CREATE_IPKG_TARGETS),y)

$(eval $(cmake-package))

